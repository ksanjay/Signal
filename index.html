<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-M">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Strategy Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        #final-signal-display {
            @apply px-8 py-5 text-2xl sm:text-3xl font-bold text-center text-white rounded-lg shadow-lg transition-all duration-300;
        }
        .indicator-row {
            @apply flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-200;
        }
        .indicator-name {
            @apply font-semibold text-gray-800;
        }
        .indicator-value {
            @apply text-sm text-gray-600;
        }
        .indicator-state {
            @apply px-3 py-1 text-sm font-semibold rounded-full;
        }
        .state-bullish {
            @apply bg-green-100 text-green-800;
        }
        .state-bearish {
            @apply bg-red-100 text-red-800;
        }
        .state-neutral {
            @apply bg-gray-100 text-gray-800;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 350px;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .price-chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 500px;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
    </style>
    <!-- Chosen Palette: Warm Neutral (bg-gray-100, text-gray-800, white cards, with green-600, red-600, and blue-700 accents) -->
    <!-- Application Structure Plan: Upgraded to a 2-column "Dashboard" layout. Left column (lg:col-span-1) contains "Controls" (symbol input, button) and the "Latest Signal" summary. This provides at-a-glance info. The main column (lg:col-span-2) is for visualization, containing a large "Price Chart" and a sub-grid for the 3 "Indicator Charts" (RSI, MACD, Volume). This structure separates controls from detailed analysis, allowing a user to see the latest signal immediately, and then explore the *historical context* for that signal in the charts. -->
    <!-- Visualization & Content Choices:
        - Price Chart: Goal(Analyze/Change) -> Chart.js Line chart (Canvas) displaying Price, Bollinger Bands, and 50 SMA. Critically, it now *also* plots "Buy" (green) and "Sell" (red) signals (as scatter points) derived from the full historical calculation. This is the biggest improvement, showing the strategy's historical performance.
        - Indicator Charts (RSI, MACD, Volume): Goal(Analyze/Compare) -> Three separate Chart.js charts (Line/Bar) to show the *historical data* for each indicator, allowing the user to visually confirm *why* a signal occurred (e.g., "I see the signal because RSI crossed 30").
        - Latest Signal: Goal(Inform) -> The original HTML/CSS summary box is kept, but its data is now sourced from the *last entry* in the new historical calculation array.
        - All choices adhere to the NO SVG/Mermaid constraint and use Chart.js.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                Live Strategy Analysis Dashboard
            </h1>
            <p class="mt-4 text-lg text-gray-600">
                Analyzes and visualizes the "3-out-of-5" strategy by plotting historical signals on the charts.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-8">
                <div class="bg-white shadow-2xl rounded-2xl p-6 sm:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">1. Market Selection</h2>
                    <p class="text-sm text-gray-600 mb-4">
                        Enter a stock/ETF symbol (e.g., AAPL, SPY) to fetch the latest ~100 daily data periods.
                    </p>
                    <div>
                        <label for="symbol-input" class="block text-sm font-medium text-gray-700">Stock/ETF Symbol</label>
                        <input type="text" id="symbol-input" value="AAPL" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <button id="calculate-button" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 disabled:bg-gray-400">
                        Analyze Signals
                    </button>
                    <div id="data-status" class="mt-4 text-sm text-gray-500 font-mono h-24 p-3 border border-gray-200 rounded-lg bg-gray-50 overflow-y-auto">
                        Ready to analyze.
                    </div>
                </div>

                <div class="bg-white shadow-2xl rounded-2xl p-6 sm:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">2. Latest Signal</h2>
                    
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Final Composite Signal:</h3>
                    <div id="final-signal-display" class="bg-gray-500">
                        ...
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-800 mt-8 mb-3">Latest Indicator Breakdown:</h3>
                    <div id="indicator-breakdown" class="space-y-3">
                        <div class="indicator-row">
                            <span class="indicator-name">RSI (18)</span>
                            <span id="rsi-value" class="indicator-value">...</span>
                            <span id="rsi-state" class="indicator-state state-neutral">...</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-name">MACD (12, 26, 9)</span>
                            <span id="macd-value" class="indicator-value">...</span>
                            <span id="macd-state" class="indicator-state state-neutral">...</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-name">Bollinger Bands (20, 2.5)</span>
                            <span id="bb-value" class="indicator-value">...</span>
                            <span id="bb-state" class="indicator-state state-neutral">...</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-name">Volume (vs 20 SMA)</span>
                            <span id="vol-value" class="indicator-value">...</span>
                            <span id="vol-state" class="indicator-state state-neutral">...</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-name">Price Trend (vs 50 SMA)</span>
                            <span id="trend-value" class="indicator-value">...</span>
                            <span id="trend-state" class="indicator-state state-neutral">...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="lg:col-span-2 space-y-8">
                <div class="price-chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="chart-container">
                        <canvas id="rsiChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="macdChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        const apiKey = 'JQQUUJQRAX8TLXSM';
        let priceChart, rsiChart, macdChart, volumeChart;

        const initChart = (ctx, config) => {
            return new Chart(ctx, config);
        };
        
        const commonChartOptions = (title) => ({
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: { display: true, text: title, font: { size: 16 } },
                legend: { display: true, position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } }
            },
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'day', tooltipFormat: 'MMM dd, yyyy' },
                    grid: { display: false },
                    ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 7 }
                },
                y: {
                    grid: { color: '#e5e7eb' },
                    ticks: { font: { size: 10 } }
                }
            }
        });

        const initPriceChart = () => {
            const ctx = document.getElementById('priceChart').getContext('2d');
            const config = {
                type: 'line',
                data: {
                    labels: [], datasets: [
                        { label: 'Price', data: [], borderColor: '#3b82f6', borderWidth: 2, pointRadius: 0, yAxisID: 'y' },
                        { label: '50 SMA', data: [], borderColor: '#f59e0b', borderWidth: 1, pointRadius: 0, borderDash: [5, 5], yAxisID: 'y' },
                        { label: 'Upper Band', data: [], borderColor: '#ef4444', borderWidth: 1, pointRadius: 0, borderDash: [2, 2], yAxisID: 'y' },
                        { label: 'Lower Band', data: [], borderColor: '#22c55e', borderWidth: 1, pointRadius: 0, borderDash: [2, 2], fill: '-1', backgroundColor: 'rgba(239, 68, 68, 0.05)', yAxisID: 'y' },
                        {
                            label: 'Long Signal', type: 'scatter', data: [],
                            backgroundColor: '#22c55e', pointStyle: 'triangle', radius: 7, rotation: 0,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Hedge Signal', type: 'scatter', data: [],
                            backgroundColor: '#ef4444', pointStyle: 'triangle', radius: 7, rotation: 180,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: { ...commonChartOptions('Price / Bollinger Bands / 50 SMA'), scales: { x: { type: 'time', time: { unit: 'day' }, grid: { display: false } }, y: { position: 'left', grid: { color: '#e5e7eb' } } } }
            };
            priceChart = initChart(ctx, config);
        };

        const initRsiChart = () => {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            const config = {
                type: 'line',
                data: {
                    labels: [], datasets: [
                        { label: 'RSI (18)', data: [], borderColor: '#6366f1', borderWidth: 2, pointRadius: 0 },
                        { label: 'Overbought (70)', data: [], borderColor: '#ef4444', borderWidth: 1, pointRadius: 0, borderDash: [5, 5] },
                        { label: 'Oversold (30)', data: [], borderColor: '#22c55e', borderWidth: 1, pointRadius: 0, borderDash: [5, 5] }
                    ]
                },
                options: { ...commonChartOptions('RSI (18)'), scales: { x: { type: 'time', time: { unit: 'day' }, grid: { display: false }, ticks: { display: false } }, y: { min: 0, max: 100 } } }
            };
            rsiChart = initChart(ctx, config);
        };

        const initMacdChart = () => {
            const ctx = document.getElementById('macdChart').getContext('2d');
            const config = {
                type: 'line',
                data: {
                    labels: [], datasets: [
                        { label: 'MACD Line', data: [], borderColor: '#0ea5e9', borderWidth: 2, pointRadius: 0 },
                        { label: 'Signal Line', data: [], borderColor: '#f97316', borderWidth: 1, pointRadius: 0 }
                    ]
                },
                options: { ...commonChartOptions('MACD (12, 26, 9)'), scales: { x: { type: 'time', time: { unit: 'day' }, grid: { display: false }, ticks: { display: false } }, y: {} } }
            };
            macdChart = initChart(ctx, config);
        };

        const initVolumeChart = () => {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            const config = {
                type: 'bar',
                data: {
                    labels: [], datasets: [
                        { label: 'Volume', data: [], backgroundColor: '#6b7280', yAxisID: 'y' },
                        { label: '20 SMA', type: 'line', data: [], borderColor: '#f59e0b', borderWidth: 1, pointRadius: 0, yAxisID: 'y' }
                    ]
                },
                options: { ...commonChartOptions('Volume vs 20 SMA'), scales: { x: { type: 'time', time: { unit: 'day' }, grid: { display: false }, ticks: { display: false } }, y: { position: 'left' } } }
            };
            volumeChart = initChart(ctx, config);
        };

        const updateDom = (id, result) => {
            const valueEl = document.getElementById(`${id}-value`);
            if (valueEl) valueEl.textContent = result.value;
            
            const stateEl = document.getElementById(`${id}-state`);
            if (stateEl) {
                stateEl.textContent = result.state;
                stateEl.className = 'indicator-state';
                if (result.state === 'bullish') {
                    stateEl.classList.add('state-bullish');
                } else if (result.state === 'bearish') {
                    stateEl.classList.add('state-bearish');
                } else {
                    stateEl.classList.add('state-neutral');
                }
            }
        };

        const calculateSMA = (data, period) => {
            if (data.length < period) return null;
            const slice = data.slice(-period);
            const sum = slice.reduce((acc, val) => acc + val, 0);
            return sum / period;
        };

        const calculateEMA = (data, period) => {
            if (data.length < period) return null;
            const k = 2 / (period + 1);
            let ema = calculateSMA(data.slice(0, period), period);
            if (ema === null) return null;
            for (let i = period; i < data.length; i++) {
                ema = (data[i] * k) + (ema * (1 - k));
            }
            return ema;
        };

        const calculateStDev = (data, period) => {
            if (data.length < period) return null;
            const slice = data.slice(-period);
            const mean = calculateSMA(slice, period);
            if (mean === null) return null;
            const sqDiff = slice.map(val => Math.pow(val - mean, 2));
            const avgSqDiff = calculateSMA(sqDiff, period);
            if (avgSqDiff === null) return null;
            return Math.sqrt(avgSqDiff);
        };

        const calculateAllSignals = (dates, closes, volumes) => {
            let signals = [];
            let rsiValues = [];
            let macdLines = [];
            let signalLines = [];
            let macdHist = [];
            
            let avgGain = 0;
            let avgLoss = 0;

            const rsiPeriod = 18;
            const macdFast = 12, macdSlow = 26, macdSignal = 9;
            const bbPeriod = 20, bbMult = 2.5;
            const volPeriod = 20;
            const trendPeriod = 50;

            for (let i = 1; i < rsiPeriod; i++) {
                const change = closes[i] - closes[i - 1];
                if (change > 0) avgGain += change;
                else avgLoss -= change;
            }
            avgGain /= rsiPeriod;
            avgLoss /= rsiPeriod;

            let emaFast = calculateSMA(closes.slice(0, macdSlow), macdFast);
            let emaSlow = calculateSMA(closes.slice(0, macdSlow), macdSlow);
            let tempMacdLines = [];

            for (let i = 0; i < closes.length; i++) {
                const date = dates[i];
                const close = closes[i];
                const volume = volumes[i];
                
                let rsi = null, rsiState = 'neutral', rsiVal = '...';
                if (i >= rsiPeriod) {
                    if (i > rsiPeriod) {
                        const change = closes[i] - closes[i - 1];
                        let gain = change > 0 ? change : 0;
                        let loss = change < 0 ? -change : 0;
                        avgGain = (avgGain * (rsiPeriod - 1) + gain) / rsiPeriod;
                        avgLoss = (avgLoss * (rsiPeriod - 1) + loss) / rsiPeriod;
                    }
                    
                    if (avgLoss === 0) rsi = 100;
                    else {
                        const rs = avgGain / avgLoss;
                        rsi = 100 - (100 / (1 + rs));
                    }
                    rsiValues.push({ x: date, y: rsi });
                    
                    if (rsi < 30) rsiState = 'bullish';
                    else if (rsi > 70) rsiState = 'bearish';
                    rsiVal = rsi.toFixed(2);
                }

                let macdState = 'neutral', macdVal = '...';
                if (i >= macdSlow) {
                    if (i > macdSlow) {
                        emaFast = (closes[i] * (2 / (macdFast + 1))) + (emaFast * (1 - (2 / (macdFast + 1))));
                        emaSlow = (closes[i] * (2 / (macdSlow + 1))) + (emaSlow * (1 - (2 / (macdSlow + 1))));
                    }
                    const macdLine = emaFast - emaSlow;
                    tempMacdLines.push(macdLine);
                    macdLines.push({ x: date, y: macdLine });
                    
                    if (tempMacdLines.length >= macdSignal) {
                        const signalLine = calculateEMA(tempMacdLines, macdSignal);
                        if (signalLine !== null) {
                            signalLines.push({ x: date, y: signalLine });
                            macdState = macdLine > signalLine ? 'bullish' : 'bearish';
                            macdVal = `L:${macdLine.toFixed(2)}, S:${signalLine.toFixed(2)}`;
                        }
                    }
                }
                
                let bbState = 'neutral', bbVal = '...', bbBasis = null, bbUpper = null, bbLower = null;
                if (i >= bbPeriod - 1) {
                    const sma = calculateSMA(closes.slice(i - bbPeriod + 1, i + 1), bbPeriod);
                    const stdDev = calculateStDev(closes.slice(i - bbPeriod + 1, i + 1), bbPeriod);
                    if (sma !== null && stdDev !== null) {
                        bbBasis = sma;
                        bbUpper = sma + (stdDev * bbMult);
                        bbLower = sma - (stdDev * bbMult);
                        
                        if (close < bbLower) bbState = 'bearish';
                        else if (close > bbLower && close < bbUpper) bbState = 'bullish';
                        bbVal = `P:${close}, B:${bbLower.toFixed(2)}-${bbUpper.toFixed(2)}`;
                    }
                }

                let volState = 'neutral', volVal = '...', volSma = null;
                if (i >= volPeriod - 1) {
                    volSma = calculateSMA(volumes.slice(i - volPeriod + 1, i + 1), volPeriod);
                    if (volSma !== null) {
                        volState = volume > volSma ? 'bullish' : 'bearish';
                        volVal = `V:${volume}, A:${volSma.toFixed(0)}`;
                    }
                }
                
                let trendState = 'neutral', trendVal = '...', trendSma = null;
                if (i >= trendPeriod - 1) {
                    trendSma = calculateSMA(closes.slice(i - trendPeriod + 1, i + 1), trendPeriod);
                    if (trendSma !== null) {
                        trendState = close > trendSma ? 'bullish' : 'bearish';
                        trendVal = `P:${close}, A:${trendSma.toFixed(2)}`;
                    }
                }
                
                const indicators = {
                    rsi: { state: rsiState, value: rsiVal },
                    macd: { state: macdState, value: macdVal },
                    bb: { state: bbState, value: bbVal },
                    vol: { state: volState, value: volVal },
                    trend: { state: trendState, value: trendVal }
                };

                let bullishCount = 0;
                let bearishCount = 0;
                Object.values(indicators).forEach(ind => {
                    if (ind.state === 'bullish') bullishCount++;
                    else if (ind.state === 'bearish') bearishCount++;
                });
                
                let finalSignal = 'neutral';
                if (bullishCount >= 3) finalSignal = 'long';
                else if (bearishCount >= 3) finalSignal = 'hedge';
                
                signals.push({
                    date, close, volume, finalSignal, indicators,
                    calcs: { rsi, macdLine: (macdLines[i-macdSlow] || {}).y, signalLine: (signalLines[i-macdSlow-macdSignal+1] || {}).y, bbBasis, bbUpper, bbLower, volSma, trendSma }
                });
            }
            
            return signals;
        };
        
        const fetchMarketData = async (symbol) => {
            const dataStatusEl = document.getElementById('data-status');
            const calculateButton = document.getElementById('calculate-button');
            
            dataStatusEl.textContent = `Fetching ${symbol} data...`;
            calculateButton.disabled = true;
            calculateButton.textContent = 'Loading Data...';

            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol.toUpperCase()}&apikey=${apiKey}&outputsize=compact`);
                if (!response.ok) throw new Error(`Network error (Status: ${response.status})`);
                const data = await response.json();

                if (data["Error Message"] || data["Note"]) {
                    throw new Error(data["Error Message"] || data["Note"] || "API limit likely reached.");
                }
                
                const timeSeries = data["Time Series (Daily)"];
                if (!timeSeries) throw new Error("Invalid API response. 'Time Series (Daily)' not found.");
                
                const dates = Object.keys(timeSeries).sort((a, b) => new Date(a) - new Date(b));
                
                if (dates.length < 60) {
                    throw new Error(`Not enough data found (${dates.length} periods). Need at least 60.`);
                }

                const closes = dates.map(date => parseFloat(timeSeries[date]["4. close"]));
                const volumes = dates.map(date => parseFloat(timeSeries[date]["5. volume"]));
                const dateObjs = dates.map(date => new Date(date));
                
                dataStatusEl.textContent = `Successfully fetched ${dates.length} periods for ${symbol}.`;
                
                return { dateObjs, closes, volumes };

            } catch (error) {
                dataStatusEl.textContent = `Error: ${error.message}`;
                return null;
            } finally {
                calculateButton.disabled = false;
                calculateButton.textContent = 'Analyze Signals';
            }
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            initPriceChart();
            initRsiChart();
            initMacdChart();
            initVolumeChart();
            
            const calculateButton = document.getElementById('calculate-button');
            const symbolInput = document.getElementById('symbol-input');
            const finalSignalEl = document.getElementById('final-signal-display');

            calculateButton.addEventListener('click', async () => {
                const symbol = symbolInput.value;
                if (!symbol) {
                    document.getElementById('data-status').textContent = 'Please enter a symbol.';
                    return;
                }

                const marketData = await fetchMarketData(symbol);
                if (!marketData) return;

                const { dateObjs, closes, volumes } = marketData;
                const signals = calculateAllSignals(dateObjs, closes, volumes);
                
                const latest = signals[signals.length - 1];
                
                updateDom('rsi', latest.indicators.rsi);
                updateDom('macd', latest.indicators.macd);
                updateDom('bb', latest.indicators.bb);
                updateDom('vol', latest.indicators.vol);
                updateDom('trend', latest.indicators.trend);
                
                finalSignalEl.classList.remove('bg-green-600', 'bg-red-600', 'bg-gray-500');
                if (latest.finalSignal === 'long') {
                    finalSignalEl.textContent = 'STRONG LONG SIGNAL';
                    finalSignalEl.classList.add('bg-green-600');
                } else if (latest.finalSignal === 'hedge') {
                    finalSignalEl.textContent = 'STRONG HEDGE SIGNAL';
                    finalSignalEl.classList.add('bg-red-600');
                } else {
                    finalSignalEl.textContent = 'NEUTRAL / NO SIGNAL';
                    finalSignalEl.classList.add('bg-gray-500');
                }
                
                const priceData = signals.map(s => ({ x: s.date, y: s.close }));
                const sma50Data = signals.map(s => ({ x: s.date, y: s.calcs.trendSma }));
                const bbUpperData = signals.map(s => ({ x: s.date, y: s.calcs.bbUpper }));
                const bbLowerData = signals.map(s => ({ x: s.date, y: s.calcs.bbLower }));
                const longSignals = signals.filter(s => s.finalSignal === 'long').map(s => ({ x: s.date, y: s.calcs.bbLower ? s.calcs.bbLower * 0.98 : s.close * 0.98 }));
                const hedgeSignals = signals.filter(s => s.finalSignal === 'hedge').map(s => ({ x: s.date, y: s.calcs.bbUpper ? s.calcs.bbUpper * 1.02 : s.close * 1.02 }));

                priceChart.data.labels = dateObjs;
                priceChart.data.datasets[0].data = priceData;
                priceChart.data.datasets[1].data = sma50Data;
                priceChart.data.datasets[2].data = bbUpperData;
                priceChart.data.datasets[3].data = bbLowerData;
                priceChart.data.datasets[4].data = longSignals;
                priceChart.data.datasets[5].data = hedgeSignals;
                priceChart.update();
                
                const rsiData = signals.map(s => ({ x: s.date, y: s.calcs.rsi }));
                const rsi70 = dateObjs.map(d => ({ x: d, y: 70 }));
                const rsi30 = dateObjs.map(d => ({ x: d, y: 30 }));
                
                rsiChart.data.labels = dateObjs;
                rsiChart.data.datasets[0].data = rsiData;
                rsiChart.data.datasets[1].data = rsi70;
                rsiChart.data.datasets[2].data = rsi30;
                rsiChart.update();
                
                const macdLineData = signals.map(s => ({ x: s.date, y: s.calcs.macdLine }));
                const signalLineData = signals.map(s => ({ x: s.date, y: s.calcs.signalLine }));
                
                macdChart.data.labels = dateObjs;
                macdChart.data.datasets[0].data = macdLineData;
                macdChart.data.datasets[1].data = signalLineData;
                macdChart.update();

                const volumeData = signals.map(s => ({ x: s.date, y: s.volume }));
                const volSmaData = signals.map(s => ({ x: s.date, y: s.calcs.volSma }));
                
                volumeChart.data.labels = dateObjs;
                volumeChart.data.datasets[0].data = volumeData;
                volumeChart.data.datasets[1].data = volSmaData;
                volumeChart.update();
            });
            
            calculateButton.click();
        });
    </script>
</body>
</html>
